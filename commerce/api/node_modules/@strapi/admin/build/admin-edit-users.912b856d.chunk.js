"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[4263],{40874:function(B,o,e){e.r(o),e.d(o,{default:function(){return Me}});var t=e(32735),a=e(88425),s=e(5141),v=e(92891),r=e(83983),g=e(41925),n=e(52136),p=e(33997),l=e.n(p),E=e(5636),M=e(60216),P=e.n(M),K=e(88423),C=e.n(K),Z=e(33795),y=e.n(Z),T=e(9086),I=e.n(T),G=e(84968),Y=e(83281),z=e(72850),_=e(41415),D=e(15335),$=e(5803),N=e(28356),b=e(17e3),j=e(49372),F=e(27649),h=e(27677),k=e(29439),q=e(66456),Q=e(64421),ee=e(17247);const ce=async U=>{const{data:R}=await ee.be.get(`/admin/users/${U}`);return R.data},ue=async(U,R)=>{const{data:L}=await ee.be.put(`/admin/users/${U}`,R);return L.data};var me=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.username.label",defaultMessage:"Username"},name:"username",placeholder:{id:"Auth.form.username.placeholder",defaultMessage:"e.g. Kai_Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"global.password",defaultMessage:"Password"},name:"password",type:"password",size:{col:6,xs:12},autoComplete:"new-password"},{intlLabel:{id:"Auth.form.confirmPassword.label",defaultMessage:"Password confirmation"},name:"confirmPassword",type:"password",size:{col:6,xs:12},autoComplete:"new-password"}],[{intlLabel:{id:"Auth.form.active.label",defaultMessage:"Active"},name:"isActive",type:"bool",size:{col:6,xs:12}}]],ge=e(1057),pe=e(4397),Ee=e(98399),fe=function(){return window&&window.strapi&&window.strapi.isEE?e(28890).Z:e(16325).Z}(),te=["email","firstname","lastname","username","isActive","roles"],ae=function(R){var L=R.canUpdate,S=(0,E.useIntl)(),i=S.formatMessage,V=(0,s.useRouteMatch)("/settings/users/:id"),W=V.params.id,he=(0,s.useHistory)(),Pe=he.push,Le=(0,a.useAppInfos)(),ye=Le.setUserDisplayName,X=(0,a.useNotification)(),se=(0,a.useOverlayBlocker)(),De=se.lockApp,Oe=se.unlockApp;(0,a.useFocusWhenNavigate)();var ne=(0,G.useQuery)(["user",W],function(){return ce(W)},{retry:!1,keepPreviousData:!1,staleTime:1e3*20,onError:function(d){var c=d.response.status;c===403&&(X({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}}),Pe("/")),Ee.log(d.response.status)}}),Ae=ne.status,f=ne.data,Ce=function(){var u=(0,n.Z)(l().mark(function d(c,O){var x,w,A,J,le;return l().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return De(),m.prev=1,m.next=4,ue(W,I()(c,"confirmPassword"));case 4:x=m.sent,X({type:"success",message:i({id:"notification.success.saved",defaultMessage:"Saved"})}),w=a.auth.getUserInfo(),W.toString()===w.id.toString()&&(a.auth.setUserInfo(x),A=y()(c,"username")||(0,Q.Pp)(c.firstname,c.lastname),ye(A)),O.setValues(C()(c,te)),m.next=17;break;case 11:m.prev=11,m.t0=m.catch(1),J=(0,Q.Iz)(m.t0.response.data),le=Object.keys(J).reduce(function(ie,de){return ie[de]=J[de].id,ie},{}),O.setErrors(le),X({type:"warning",message:y()(m.t0,"response.data.message","notification.error")});case 17:Oe();case 18:case"end":return m.stop()}},d,null,[[1,11]])}));return function(c,O){return u.apply(this,arguments)}}(),re=Ae!=="success",Te=re?{id:"app.containers.Users.EditPage.header.label-loading",defaultMessage:"Edit user"}:{id:"app.containers.Users.EditPage.header.label",defaultMessage:"Edit {name}"},H=Object.keys(C()(f,te)).reduce(function(u,d){return d==="roles"?(u[d]=(f?.roles||[]).map(function(c){var O=c.id;return O}),u):(u[d]=f?.[d],u)},{}),Ie=H.username||(0,Q.Pp)(H.firstname,H.lastname),oe=i(Te,{name:Ie});return re?t.createElement(F.o,{"aria-busy":"true"},t.createElement(a.SettingsPageTitle,{name:"Users"}),t.createElement(N.T,{primaryAction:t.createElement(_.z,{disabled:!0,startIcon:t.createElement(q.Z,null),type:"button",size:"L"},i({id:"global.save",defaultMessage:"Save"})),title:oe,navigationAction:t.createElement(a.Link,{startIcon:t.createElement(k.Z,null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},i({id:"global.back",defaultMessage:"Back"}))}),t.createElement(b.D,null,t.createElement(a.LoadingIndicatorPage,null))):t.createElement(F.o,null,t.createElement(a.SettingsPageTitle,{name:"Users"}),t.createElement(Y.Formik,{onSubmit:Ce,initialValues:H,validateOnChange:!1,validationSchema:ge.YM},function(u){var d=u.errors,c=u.values,O=u.handleChange,x=u.isSubmitting;return t.createElement(a.Form,null,t.createElement(N.T,{primaryAction:t.createElement(_.z,{disabled:x||!L,startIcon:t.createElement(q.Z,null),loading:x,type:"submit",size:"L"},i({id:"global.save",defaultMessage:"Save"})),title:oe,navigationAction:t.createElement(a.Link,{startIcon:t.createElement(k.Z,null),to:"/settings/users?pageSize=10&page=1&sort=firstname"},i({id:"global.back",defaultMessage:"Back"}))}),t.createElement(b.D,null,f?.registrationToken&&t.createElement(z.x,{paddingBottom:6},t.createElement(fe,{registrationToken:f.registrationToken})),t.createElement(h.K,{spacing:7},t.createElement(z.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(h.K,{spacing:4},t.createElement(j.Z,{variant:"delta",as:"h2"},i({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"Details"})),t.createElement(D.r,{gap:5},me.map(function(w){return w.map(function(A){return t.createElement($.P,(0,g.Z)({key:A.name},A.size),t.createElement(a.GenericInput,(0,g.Z)({},A,{disabled:!L,error:d[A.name],onChange:O,value:c[A.name]||""})))})})))),t.createElement(z.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(h.K,{spacing:4},t.createElement(j.Z,{variant:"delta",as:"h2"},i({id:"global.roles",defaultMessage:"User's role"})),t.createElement(D.r,{gap:5},t.createElement($.P,{col:6,xs:12},t.createElement(pe.Z,{disabled:!L,error:d.roles,onChange:O,value:c.roles}))))))))}))};ae.propTypes={canUpdate:P().bool.isRequired};var ve=ae,Me=()=>{const U=(0,a.useNotification)(),R=(0,t.useMemo)(()=>({read:r.Z.settings.users.read,update:r.Z.settings.users.update}),[]),{isLoading:L,allowedActions:{canRead:S,canUpdate:i}}=(0,a.useRBAC)(R),{state:V}=(0,s.useLocation)(),W=(0,v.get)(V,"from","/");return(0,t.useEffect)(()=>{L||!S&&!i&&U({type:"info",message:{id:"notification.permission.not-allowed-read",defaultMessage:"You are not allowed to see this document"}})},[L,S,i,U]),L?t.createElement(a.LoadingIndicatorPage,null):!S&&!i?t.createElement(s.Redirect,{to:W}):t.createElement(ve,{canUpdate:i})}},76779:function(B,o,e){var t=e(32735),a=e(60216),s=e.n(a),v=e(50563),r=e(88425),g=e.n(r),n=e(47765),p=e(59087),l=e.n(p),E=e(5636);const M=()=>t.createElement("svg",{xmlns:"http://www.w3.org/2000/svg"},t.createElement("text",{transform:"translate(-23 -9)",fill:"#4B515A",fillRule:"evenodd",fontSize:"32",fontFamily:"AppleColorEmoji, Apple Color Emoji"},t.createElement("tspan",{x:"23",y:"36"},"\u2709\uFE0F"))),P=({children:K,target:C})=>{const Z=(0,r.useNotification)(),{formatMessage:y}=(0,E.useIntl)(),T=()=>{Z({type:"info",message:{id:"notification.link-copied"}})},I=y({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"});return t.createElement(r.ContentBox,{endAction:t.createElement(p.CopyToClipboard,{onCopy:T,text:C},t.createElement(v.h,{label:I,noBorder:!0,icon:t.createElement(n.Z,null)})),title:C,titleEllipsis:!0,subtitle:K,icon:t.createElement(M,null),iconBackground:"neutral100"})};P.propTypes={children:s().oneOfType([s().element,s().string]).isRequired,target:s().string.isRequired},o.Z=P},16325:function(B,o,e){var t=e(32735),a=e(5636),s=e(60216),v=e.n(s),r=e(463),g=e(76779);const n=({registrationToken:p})=>{const{formatMessage:l}=(0,a.useIntl)(),E=`${window.location.origin}${r.Z}auth/register?registrationToken=${p}`;return t.createElement(g.Z,{target:E},l({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"}))};n.defaultProps={registrationToken:""},n.propTypes={registrationToken:v().string},o.Z=n},4397:function(B,o,e){var t=e(32735),a=e(60216),s=e.n(a),v=e(5636),r=e(70218),g=e(84967),n=e(84968),p=e.n(n),l=e(83292),E=e(27169),M=e(17247);const P=l.keyframes`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,K=l.default.div`
  animation: ${P} 2s infinite linear;
`,C=()=>t.createElement(K,null,t.createElement(E.Z,null)),Z=async()=>{const{data:T}=await M.be.get("/admin/roles");return T.data},y=({disabled:T,error:I,onChange:G,value:Y})=>{const{status:z,data:_}=(0,n.useQuery)(["roles"],Z,{staleTime:5e4}),{formatMessage:D}=(0,v.useIntl)(),$=I?D({id:I,defaultMessage:I}):"",N=D({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),b=D({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),j=D({id:"app.components.Select.placeholder",defaultMessage:"Select"}),F=z==="loading"?t.createElement(C,null):void 0;return t.createElement(r.P,{id:"roles",disabled:T,error:$,hint:b,label:N,name:"roles",onChange:h=>{G({target:{name:"roles",value:h}})},placeholder:j,multi:!0,startIcon:F,value:Y,withTags:!0,required:!0},(_||[]).map(h=>t.createElement(g.W,{key:h.id,value:h.id},D({id:`global.${h.code}`,defaultMessage:h.name}))))};y.defaultProps={disabled:!1,error:void 0},y.propTypes={disabled:s().bool,error:s().string,onChange:s().func.isRequired,value:s().array.isRequired},o.Z=y},1057:function(B,o,e){e.d(o,{YM:function(){return l},Rw:function(){return r}});var t=e(5173),a=e(88425);const s={firstname:t.Z_().trim().required(a.translatedErrors.required),lastname:t.Z_(),email:t.Z_().email(a.translatedErrors.email).lowercase().required(a.translatedErrors.required),username:t.Z_().nullable(),password:t.Z_().min(8,a.translatedErrors.minLength).matches(/[a-z]/,"components.Input.error.contain.lowercase").matches(/[A-Z]/,"components.Input.error.contain.uppercase").matches(/\d/,"components.Input.error.contain.number"),confirmPassword:t.Z_().min(8,a.translatedErrors.minLength).oneOf([t.iH("password"),null],"components.Input.error.password.noMatch").when("password",(E,M)=>E?M.required(a.translatedErrors.required):M)};var r={...s,currentPassword:t.Z_().when(["password","confirmPassword"],(E,M,P)=>E||M?P.required(a.translatedErrors.required):P),preferedLanguage:t.Z_().nullable()},n={roles:t.IX().min(1,a.translatedErrors.required).required(a.translatedErrors.required)},l=t.Ry().shape({...s,isActive:t.Xg(),...n})},28890:function(B,o,e){var t=e(32735),a=e(5636),s=e(60216),v=e.n(s),r=e(463),g=e(76779);const n=({registrationToken:p})=>{const{formatMessage:l}=(0,a.useIntl)();return p?t.createElement(g.Z,{target:`${window.location.origin}${r.Z}auth/register?registrationToken=${p}`},l({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})):t.createElement(g.Z,{target:`${window.location.origin}${r.Z}auth/login`},l({id:"app.components.Users.MagicLink.connect.sso",defaultMessage:"Send this link to the user, the first login can be made via a SSO provider."}))};n.defaultProps={registrationToken:""},n.propTypes={registrationToken:v().string},o.Z=n},27169:function(B,o,e){e.d(o,{Z:function(){return a}});var t=e(74512);function a(s){return(0,t.jsx)("svg",{width:"1em",height:"1em",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s,children:(0,t.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12.057 18c.552 0 1 .451 1 .997v4.006a1 1 0 01-.941.995l-.059.002c-.552 0-1-.451-1-.997v-4.006a1 1 0 01.941-.995l.06-.002zm-3.06-.736l.055.03c.478.276.64.89.367 1.364l-2.002 3.468a1 1 0 01-1.31.394l-.055-.03a1.002 1.002 0 01-.368-1.363l2.003-3.469a1 1 0 011.31-.394zm7.42.394l2.002 3.468a1 1 0 01-.314 1.331l-.053.033a1.002 1.002 0 01-1.365-.363l-2.003-3.469a1 1 0 01.314-1.33l.054-.034a1.002 1.002 0 011.364.364zm-9.548-2.66l.033.054c.276.478.11 1.091-.364 1.364L3.07 18.42a1 1 0 01-1.331-.314l-.033-.053a1.001 1.001 0 01.364-1.365l3.468-2.003a1 1 0 011.33.314zm11.79-.313l3.468 2.002a1 1 0 01.393 1.31l-.03.055c-.276.478-.89.64-1.363.367l-3.469-2.003a1 1 0 01-.394-1.309l.03-.055c.276-.479.89-.64 1.364-.367zm4.344-3.628a1 1 0 01.995.941l.002.06c0 .551-.451 1-.997 1h-4.006a1 1 0 01-.995-.942L18 12.057c0-.552.451-1 .997-1h4.006zm-18 0a1 1 0 01.995.941l.002.06c0 .551-.451 1-.998 1H.998a1 1 0 01-.996-.942L0 12.057c0-.552.451-1 .998-1h4.004zm17.454-5.059l.033.054c.277.478.11 1.091-.363 1.365l-3.469 2.002a1 1 0 01-1.33-.314l-.034-.053a1.002 1.002 0 01.364-1.365l3.468-2.003a1 1 0 011.331.314zM3.07 5.684l3.468 2.003a1 1 0 01.394 1.31l-.03.055c-.276.478-.89.64-1.364.367L2.07 7.417a1 1 0 01-.394-1.31l.03-.055c.276-.479.89-.64 1.364-.368zm14.926-4.008l.056.03c.478.276.64.89.367 1.364l-2.003 3.468a1 1 0 01-1.309.394l-.055-.03a1.002 1.002 0 01-.367-1.364l2.002-3.468a1 1 0 011.31-.394zm-10.58.394L9.42 5.538a1 1 0 01-.314 1.33l-.053.034a1.002 1.002 0 01-1.365-.364L5.684 3.07a1 1 0 01.314-1.331l.054-.033a1.002 1.002 0 011.365.364zM12.058 0c.552 0 1 .451 1 .998v4.004a1 1 0 01-.941.996L12.057 6c-.552 0-1-.451-1-.998V.998a1 1 0 01.941-.996l.06-.002z",fill:"#212134"})})}}}]);
