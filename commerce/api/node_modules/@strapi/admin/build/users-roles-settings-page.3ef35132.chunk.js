"use strict";(self.webpackChunk_strapi_admin=self.webpackChunk_strapi_admin||[]).push([[8853],{77495:function(te,I,a){a.r(I),a.d(I,{default:function(){return Tt}});var e=a(32735),h=a(5141),d=a(88425),f=a(90201),P=a(88369),T=a(41415),X=a(96709),j=a(28356),N=a(99223),U=a(17e3),k=a(27649),K=a(94745),w=a(76330),B=a(29005),A=a(66735),Re=a(3685),y=a(49372),Ce=a(94638),Pe=a(19406),Z=a(5636),Y=a(84968),Te=a(58469),O=a(59677);const Ae=async(t,n)=>{try{const{data:s}=await O.be.get((0,O.Gc)("roles"));return n("The roles have loaded successfully"),s}catch{throw t({type:"warning",message:{id:"notification.error"}}),new Error("error")}},De=async(t,n)=>{try{await O.be.delete(`${(0,O.Gc)("roles")}/${t}`)}catch{n({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}};var be=a(60216),v=a.n(be),se=a(50563),J=a(87933),Le=a(3594),Se=a(68625),Me=a(4038);const q=({sortedRoles:t,canDelete:n,permissions:s,setRoleToDelete:r,onDelete:u})=>{const{formatMessage:o}=(0,Z.useIntl)(),{push:i}=(0,h.useHistory)(),[c,m]=u,g=l=>n&&!["public","authenticated"].includes(l.type),p=l=>{r(l),m(!c)},E=l=>{i(`/settings/${f.Z}/roles/${l}`)};return e.createElement(Le.p,null,t?.map(l=>e.createElement(B.Tr,{key:l.name,...(0,d.onRowClick)({fn:()=>E(l.id)})},e.createElement(A.Td,{width:"20%"},e.createElement(y.Z,null,l.name)),e.createElement(A.Td,{width:"50%"},e.createElement(y.Z,null,l.description)),e.createElement(A.Td,{width:"30%"},e.createElement(y.Z,null,`${l.nb_users} ${o({id:"global.users",defaultMessage:"users"}).toLowerCase()}`)),e.createElement(A.Td,null,e.createElement(J.k,{justifyContent:"end",...d.stopPropagation},e.createElement(d.CheckPermissions,{permissions:s.updateRole},e.createElement(se.h,{onClick:()=>E(l.id),noBorder:!0,icon:e.createElement(Se.Z,null),label:o({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:`${l.name}`})})),g(l)&&e.createElement(d.CheckPermissions,{permissions:s.deleteRole},e.createElement(se.h,{onClick:()=>p(l.id),noBorder:!0,icon:e.createElement(Me.default,null),label:o({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${l.name}`})})))))))};var Ze=q;q.defaultProps={canDelete:!1},q.propTypes={onDelete:v().array.isRequired,permissions:v().object.isRequired,setRoleToDelete:v().func.isRequired,sortedRoles:v().array.isRequired,canDelete:v().bool};var Oe=()=>{const{trackUsage:t}=(0,d.useTracking)(),{formatMessage:n}=(0,Z.useIntl)(),{push:s}=(0,h.useHistory)(),r=(0,d.useNotification)(),{notifyStatus:u}=(0,Ce.G)(),[{query:o}]=(0,d.useQueryParams)(),i=o?._q||"",[c,m]=(0,e.useState)(!1),[g,p]=(0,e.useState)(!1),[E,l]=(0,e.useState)();(0,d.useFocusWhenNavigate)();const C=(0,Y.useQueryClient)(),R=(0,e.useMemo)(()=>({create:P.Z.createRole,read:P.Z.readRoles,update:P.Z.updateRole,delete:P.Z.deleteRole}),[]),{isLoading:b,allowedActions:{canRead:L,canDelete:F}}=(0,d.useRBAC)(R),{isLoading:At,data:{roles:ye},isFetching:Dt}=(0,Y.useQuery)("get-roles",()=>Ae(r,u),{initialData:{},enabled:L}),ve=At||Dt,bt=()=>{t("willCreateRole"),s(`/settings/${f.Z}/roles/new`)},Lt=()=>{m(!c)},St={roles:{id:(0,O.OB)("Roles.empty"),defaultMessage:"You don't have any roles yet."},search:{id:(0,O.OB)("Roles.empty.search"),defaultMessage:"No roles match the search."}},Mt=n({id:"global.roles",defaultMessage:"Roles"}),Zt=(0,Y.useMutation)(Nt=>De(Nt,r),{async onSuccess(){await C.invalidateQueries("get-roles")}}),Ot=async()=>{p(!0),await Zt.mutateAsync(E),m(!c),p(!1)},Q=(0,Te.ZP)(ye||[],i,{keys:["name","description"]}),Ut=i&&!Q.length?"search":"roles",xt=4,It=(ye?.length||0)+1;return e.createElement(X.A,null,e.createElement(d.SettingsPageTitle,{name:Mt}),e.createElement(k.o,{"aria-busy":ve},e.createElement(j.T,{title:n({id:"global.roles",defaultMessage:"Roles"}),subtitle:n({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),primaryAction:e.createElement(d.CheckPermissions,{permissions:P.Z.createRole},e.createElement(T.z,{onClick:bt,startIcon:e.createElement(Pe.default,null),size:"S"},n({id:(0,O.OB)("List.button.roles"),defaultMessage:"Add new role"})))}),e.createElement(N.Z,{startActions:e.createElement(d.SearchURLQuery,{label:n({id:"app.component.search.label",defaultMessage:"Search"})})}),e.createElement(U.D,null,!L&&e.createElement(d.NoPermissions,null),(ve||b)&&e.createElement(d.LoadingIndicatorPage,null),L&&Q&&Q?.length?e.createElement(K.i,{colCount:xt,rowCount:It},e.createElement(w.h,null,e.createElement(B.Tr,null,e.createElement(A.Th,null,e.createElement(y.Z,{variant:"sigma",textColor:"neutral600"},n({id:"global.name",defaultMessage:"Name"}))),e.createElement(A.Th,null,e.createElement(y.Z,{variant:"sigma",textColor:"neutral600"},n({id:"global.description",defaultMessage:"Description"}))),e.createElement(A.Th,null,e.createElement(y.Z,{variant:"sigma",textColor:"neutral600"},n({id:"global.users",defaultMessage:"Users"}))),e.createElement(A.Th,null,e.createElement(Re.T,null,n({id:"global.actions",defaultMessage:"Actions"}))))),e.createElement(Ze,{sortedRoles:Q,canDelete:F,permissions:P.Z,setRoleToDelete:l,onDelete:[c,m]})):e.createElement(d.EmptyStateLayout,{content:St[Ut]})),e.createElement(d.ConfirmDialog,{isConfirmButtonLoading:g,onConfirm:Ot,onToggleDialog:Lt,isOpen:c})))},Ue=()=>e.createElement(d.CheckPagePermissions,{permissions:P.Z.accessRoles},e.createElement(Oe,null)),ne=a(83281),D=a(27677),S=a(72850),ae=a(10369),re=a(10508),xe=a(29439),oe=a(66456),H=a(15335),x=a(5803),G=a(82069),M=a(92891);const ie=(0,e.createContext)({}),le=({children:t,value:n})=>e.createElement(ie.Provider,{value:n},t),_=()=>(0,e.useContext)(ie);le.propTypes={children:v().node.isRequired,value:v().object.isRequired};var V=a(83292),Ie=a(37213),Ne=a.n(Ie),ke=a(15738),Be=a.n(ke),Ge=t=>{switch(t){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}};const $e=(0,V.default)(S.x)`
  margin: -1px;
  border-radius: ${({theme:t})=>t.spaces[1]} 0 0 ${({theme:t})=>t.spaces[1]};
`;function ee({route:t}){const{formatMessage:n}=(0,Z.useIntl)(),{method:s,handler:r,path:u}=t,o=u?Be()(u.split("/")):[],[i="",c=""]=r?r.split("."):[],m=Ge(t.method);return e.createElement(D.K,{spacing:2},e.createElement(y.Z,{variant:"delta",as:"h3"},n({id:"users-permissions.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",e.createElement("span",null,i),e.createElement(y.Z,{variant:"delta",textColor:"primary600"},".",c)),e.createElement(D.K,{horizontal:!0,hasRadius:!0,background:"neutral0",borderColor:"neutral200",spacing:0},e.createElement($e,{background:m.background,borderColor:m.border,padding:2},e.createElement(y.Z,{fontWeight:"bold",textColor:m.text},s)),e.createElement(S.x,{paddingLeft:2,paddingRight:2},Ne()(o,g=>e.createElement(y.Z,{key:g,textColor:g.includes(":")?"neutral600":"neutral900"},"/",g)))))}ee.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},ee.propTypes={route:v().shape({handler:v().string,method:v().string,path:v().string})};var Fe=ee,je=()=>{const{formatMessage:t}=(0,Z.useIntl)(),{selectedAction:n,routes:s}=_(),r=(0,M.without)(n.split("."),"controllers"),u=(0,M.get)(s,r[0]),o=r.slice(1).join("."),i=(0,M.isEmpty)(u)?[]:u.filter(c=>c.handler.endsWith(o));return e.createElement(x.P,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},n?e.createElement(D.K,{spacing:2},i.map((c,m)=>e.createElement(Fe,{key:m,route:c}))):e.createElement(D.K,{spacing:2},e.createElement(y.Z,{variant:"delta",as:"h3"},t({id:"users-permissions.Policies.header.title",defaultMessage:"Advanced settings"})),e.createElement(y.Z,{as:"p",textColor:"neutral600"},t({id:"users-permissions.Policies.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))},Ke=a(83828),we=a(61762),He=a(89966),Ve=a(23940),We=a.n(Ve);function ze(t){switch(t){case"application":return"Application";case"plugin::content-manager":return"Content manager";case"plugin::content-type-builder":return"Content types builder";case"plugin::documentation":return"Documentation";case"plugin::email":return"Email";case"plugin::i18n":return"i18n";case"plugin::upload":return"Upload";case"plugin::users-permissions":return"Users-permissions";default:return We()(t.replace("api::","").replace("plugin::",""))}}var Qe=ze,Xe=a(98978),ce=a.n(Xe),de=a(8284),Ye=a(45112);const ue=V.css`
  background: ${t=>t.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`;var Je=(0,V.default)(S.x)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${t=>t.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${t=>t.isActive&&ue}
  &:hover {
    ${ue}
  }
`;const qe=V.default.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:t})=>t.colors.neutral150};
`,me=({subCategory:t})=>{const{formatMessage:n}=(0,Z.useIntl)(),{onChange:s,onChangeSelectAll:r,onSelectedAction:u,selectedAction:o,modifiedData:i}=_(),c=(0,e.useMemo)(()=>(0,M.get)(i,t.name,{}),[i,t]),m=(0,e.useMemo)(()=>Object.values(c).every(l=>l.enabled===!0),[c]),g=(0,e.useMemo)(()=>Object.values(c).some(l=>l.enabled===!0)&&!m,[c,m]),p=(0,e.useCallback)(({target:{name:l}})=>{r({target:{name:l,value:!m}})},[m,r]),E=(0,e.useCallback)(l=>o===l,[o]);return e.createElement(S.x,null,e.createElement(J.k,{justifyContent:"space-between",alignItems:"center"},e.createElement(S.x,{paddingRight:4},e.createElement(y.Z,{variant:"sigma",textColor:"neutral600"},t.label)),e.createElement(qe,null),e.createElement(S.x,{paddingLeft:4},e.createElement(de.X,{name:t.name,value:m,onValueChange:l=>p({target:{name:t.name,value:l}}),indeterminate:g},n({id:"app.utils.select-all",defaultMessage:"Select all"})))),e.createElement(J.k,{paddingTop:6,paddingBottom:6},e.createElement(H.r,{gap:2,style:{flex:1}},t.actions.map(l=>{const C=`${l.name}.enabled`;return e.createElement(x.P,{col:6,key:l.name},e.createElement(Je,{isActive:E(l.name),padding:2,hasRadius:!0},e.createElement(de.X,{value:(0,M.get)(i,C,!1),name:C,onValueChange:R=>s({target:{name:C,value:R}})},l.label),e.createElement("button",{type:"button","data-testid":"action-cog",onClick:()=>u(l.name),style:{display:"inline-flex",alignItems:"center"}},e.createElement(Ye.Z,null))))}))))};me.propTypes={subCategory:v().object.isRequired};var _e=me;const ge=({name:t,permissions:n})=>{const s=(0,e.useMemo)(()=>ce()(Object.values(n.controllers).reduce((r,u,o)=>{const i=`${t}.controllers.${Object.keys(n.controllers)[o]}`,c=ce()(Object.keys(u).reduce((m,g)=>[...m,{...u[g],label:g,name:`${i}.${g}`}],[]),"label");return[...r,{actions:c,label:Object.keys(n.controllers)[o],name:i}]},[]),"label"),[t,n]);return e.createElement(S.x,{padding:6},s.map(r=>e.createElement(_e,{key:r.name,subCategory:r})))};ge.propTypes={name:v().string.isRequired,permissions:v().object.isRequired};var et=ge,tt=(t,n)=>{const s=Object.keys(n).sort().map(r=>({name:r,isOpen:!1}));return{...t,collapses:s}},W=a(97889);const st={collapses:[]},nt=(t,n)=>(0,W.default)(t,s=>{switch(n.type){case"TOGGLE_COLLAPSE":{s.collapses=t.collapses.map((r,u)=>u===n.index?{...r,isOpen:!r.isOpen}:{...r,isOpen:!1});break}default:return s}});var at=()=>{const{modifiedData:t}=_(),{formatMessage:n}=(0,Z.useIntl)(),[{collapses:s},r]=(0,e.useReducer)(nt,st,o=>tt(o,t)),u=o=>r({type:"TOGGLE_COLLAPSE",index:o});return e.createElement(D.K,{spacing:1},s.map((o,i)=>e.createElement(Ke.U,{expanded:o.isOpen,onToggle:()=>u(i),key:o.name,variant:i%2===0?"secondary":void 0},e.createElement(we.B,{title:Qe(o.name),description:n({id:"users-permissions.Plugin.permissions.plugins.description",defaultMessage:"Define all allowed actions for the {name} plugin."},{name:o.name}),variant:i%2?"primary":"secondary"}),e.createElement(He.v,null,e.createElement(S.x,null,e.createElement(et,{permissions:t[o.name],name:o.name}))))))};const rt={initialData:{},modifiedData:{},routes:{},selectedAction:"",policies:[]};var ot=(t,n)=>(0,W.default)(t,s=>{switch(n.type){case"ON_CHANGE":{const r=n.keys.length,u=n.keys[r-1]==="enabled";if(n.value&&u){const o=(0,M.take)(n.keys,r-1).join(".");s.selectedAction=o}(0,M.set)(s,["modifiedData",...n.keys],n.value);break}case"ON_CHANGE_SELECT_ALL":{const r=["modifiedData",...n.keys],u=(0,M.get)(t,r,{}),o=Object.keys(u).reduce((i,c)=>(i[c]={...u[c],enabled:n.value},i),{});(0,M.set)(s,r,o);break}case"ON_RESET":{s.modifiedData=t.initialData;break}case"ON_SUBMIT_SUCCEEDED":{s.initialData=t.modifiedData;break}case"SELECT_ACTION":{const{actionToSelect:r}=n;s.selectedAction=r===t.selectedAction?"":r;break}default:return s}}),it=(t,n,s)=>({...t,initialData:n,modifiedData:n,routes:s});const pe=(0,e.forwardRef)(({permissions:t,routes:n},s)=>{const{formatMessage:r}=(0,Z.useIntl)(),[u,o]=(0,e.useReducer)(ot,rt,p=>it(p,t,n));(0,e.useImperativeHandle)(s,()=>({getPermissions(){return{permissions:u.modifiedData}},resetForm(){o({type:"ON_RESET"})},setFormAfterSubmit(){o({type:"ON_SUBMIT_SUCCEEDED"})}}));const g={...u,onChange:({target:{name:p,value:E}})=>o({type:"ON_CHANGE",keys:p.split("."),value:E==="empty__string_value"?"":E}),onChangeSelectAll:({target:{name:p,value:E}})=>o({type:"ON_CHANGE_SELECT_ALL",keys:p.split("."),value:E}),onSelectedAction:p=>o({type:"SELECT_ACTION",actionToSelect:p})};return e.createElement(le,{value:g},e.createElement(H.r,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},e.createElement(x.P,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(D.K,{spacing:6},e.createElement(D.K,{spacing:2},e.createElement(y.Z,{variant:"delta",as:"h2"},r({id:(0,G.Z)("Plugins.header.title"),defaultMessage:"Permissions"})),e.createElement(y.Z,{as:"p",textColor:"neutral600"},r({id:(0,G.Z)("Plugins.header.description"),defaultMessage:"Only actions bound by a route are listed below."}))),e.createElement(at,null))),e.createElement(je,null)))});pe.propTypes={permissions:v().object.isRequired,routes:v().object.isRequired};var Ee=(0,e.memo)(pe);const Vt={isLoading:!0,modifiedData:{}},Wt=(t,n)=>produce(t,s=>{switch(n.type){case"GET_DATA":{s.isLoading=!0,s.modifiedData={};break}case"GET_DATA_SUCCEEDED":{s.isLoading=!1,s.modifiedData=n.data;break}case"GET_DATA_ERROR":{s.isLoading=!0;break}case"ON_SUBMIT_SUCCEEDED":{s.modifiedData=n.data;break}default:return s}});var zt=null,lt=a(98399);const Qt=(t,n)=>{const{isLoading:s,allowedActions:r}=useRBAC(n),[{isLoading:u,modifiedData:o},i]=useReducer(reducer,initialState),c=useNotification(),m=useRef(!0),g=new AbortController,{signal:p}=g;useEffect(()=>(s||(async()=>{try{i({type:"GET_DATA"});const C=await request(getRequestURL(t),{method:"GET",signal:p});i({type:"GET_DATA_SUCCEEDED",data:C})}catch(C){m.current&&(i({type:"GET_DATA_ERROR"}),lt.error(C),c({type:"warning",message:{id:"notification.error"}}))}})(),()=>{g.abort(),m.current=!1}),[s,t]);const E=useCallback(l=>{i({type:"ON_SUBMIT_SUCCEEDED",data:l})},[]);return{allowedActions:r,dispatchSubmitSucceeded:E,isLoading:u,isLoadingForPermissions:s,modifiedData:o}};var Xt=null;const Yt={roles:[],isLoading:!0},Jt=(t,n)=>produce(t,s=>{switch(n.type){case"GET_DATA":{s.isLoading=!0,s.roles=[];break}case"GET_DATA_SUCCEEDED":{s.roles=n.data,s.isLoading=!1;break}case"GET_DATA_ERROR":{s.isLoading=!1;break}default:return s}});var qt=null;const _t=(t=!0)=>{const[{roles:n,isLoading:s},r]=useReducer(reducer,initialState,()=>init(initialState,t)),u=useNotification(),o=useRef(!0),i=new AbortController,{signal:c}=i;useEffect(()=>(t&&m(),()=>{i.abort(),o.current=!1}),[t]);const m=async()=>{try{r({type:"GET_DATA"});const{roles:g}=await request(`/${pluginId}/roles`,{method:"GET",signal:c});r({type:"GET_DATA_SUCCEEDED",data:g})}catch(g){const p=get(g,["response","payload","message"],"An error occured");o.current&&(r({type:"GET_DATA_ERROR"}),p!=="Forbidden"&&u({type:"warning",message:p}))}};return{roles:n,isLoading:s,getData:m}};var es=null,ct=(t,n)=>({...t,isLoading:n}),z=a(8917);const he={permissions:{},routes:{},isLoading:!0};var dt=(t,n)=>(0,W.default)(t,s=>{switch(n.type){case"GET_DATA":{s.isLoading=!0,s.permissions={},s.routes={};break}case"GET_DATA_SUCCEEDED":{s.permissions=n.permissions,s.routes=n.routes,s.isLoading=!1;break}case"GET_DATA_ERROR":{s.isLoading=!1;break}default:return s}}),fe=(t=!0)=>{const n=(0,d.useNotification)(),[{permissions:s,routes:r,isLoading:u},o]=(0,e.useReducer)(dt,he,()=>ct(he,t)),i=(0,e.useCallback)(async()=>{try{o({type:"GET_DATA"});const[{permissions:c},{routes:m}]=await Promise.all([`/${f.Z}/permissions`,`/${f.Z}/routes`].map(async g=>(await z.Z.get(g)).data));o({type:"GET_DATA_SUCCEEDED",permissions:(0,O.YX)(c),routes:m})}catch(c){const m=(0,M.get)(c,["response","payload","message"],"An error occured");o({type:"GET_DATA_ERROR"}),m!=="Forbidden"&&n({type:"warning",message:m})}},[n]);return(0,e.useEffect)(()=>{t&&i()},[i,t]),{permissions:s,routes:r,getData:i,isLoading:u}};const ut={role:{},isLoading:!0};var mt=(t,n)=>(0,W.default)(t,s=>{switch(n.type){case"GET_DATA_SUCCEEDED":{s.role=n.role,s.isLoading=!1;break}case"GET_DATA_ERROR":{s.isLoading=!1;break}case"ON_SUBMIT_SUCCEEDED":{s.role.name=n.name,s.role.description=n.description;break}default:return s}}),gt=a(98399),pt=t=>{const[n,s]=(0,e.useReducer)(mt,ut),r=(0,d.useNotification)(),u=(0,e.useRef)(null);(0,e.useEffect)(()=>(u.current=!0,t?o(t):s({type:"GET_DATA_SUCCEEDED",role:{}}),()=>u.current=!1),[t]);const o=async c=>{try{const{data:{role:m}}=await z.Z.get(`/${f.Z}/roles/${c}`);u.current&&s({type:"GET_DATA_SUCCEEDED",role:m})}catch(m){gt.error(m),s({type:"GET_DATA_ERROR"}),r({type:"warning",message:{id:"notification.error"}})}},i=(0,e.useCallback)(c=>{s({type:"ON_SUBMIT_SUCCEEDED",...c})},[]);return{...n,onSubmitSucceeded:i}},$=a(5173),Et=$.Ry().shape({name:$.Z_().required(d.translatedErrors.required),description:$.Z_().required(d.translatedErrors.required)}),ht=a(98399),ft=()=>{const{formatMessage:t}=(0,Z.useIntl)(),[n,s]=(0,e.useState)(!1),r=(0,d.useNotification)(),{lockApp:u,unlockApp:o}=(0,d.useOverlayBlocker)(),{params:{id:i}}=(0,h.useRouteMatch)(`/settings/${f.Z}/roles/:id`),{isLoading:c,routes:m}=fe(),{role:g,onSubmitSucceeded:p,isLoading:E}=pt(i),l=(0,e.useRef)(),C=async R=>{u(),s(!0);try{const b=l.current.getPermissions();await z.Z.put(`/${f.Z}/roles/${i}`,{...R,...b,users:[]}),p({name:R.name,description:R.description}),r({type:"success",message:{id:(0,G.Z)("Settings.roles.edited"),defaultMessage:"Role edited"}})}catch(b){ht.error(b),r({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}s(!1),o()};return E?e.createElement(d.LoadingIndicatorPage,null):e.createElement(k.o,null,e.createElement(d.SettingsPageTitle,{name:"Roles"}),e.createElement(ne.Formik,{enableReinitialize:!0,initialValues:{name:g.name,description:g.description},onSubmit:C,validationSchema:Et},({handleSubmit:R,values:b,handleChange:L,errors:F})=>e.createElement(d.Form,{noValidate:!0,onSubmit:R},e.createElement(j.T,{primaryAction:!c&&e.createElement(T.z,{disabled:g.code==="strapi-super-admin",type:"submit",loading:n,startIcon:e.createElement(oe.Z,null)},t({id:"global.save",defaultMessage:"Save"})),title:g.name,subtitle:g.description,navigationAction:e.createElement(d.Link,{startIcon:e.createElement(xe.Z,null),to:"/settings/users-permissions/roles"},t({id:"global.back",defaultMessage:"Back"}))}),e.createElement(U.D,null,e.createElement(D.K,{spacing:7},e.createElement(S.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(D.K,{spacing:4},e.createElement(y.Z,{variant:"delta",as:"h2"},t({id:(0,G.Z)("EditPage.form.roles"),defaultMessage:"Role details"})),e.createElement(H.r,{gap:4},e.createElement(x.P,{col:6},e.createElement(ae.o,{name:"name",value:b.name||"",onChange:L,label:t({id:"global.name",defaultMessage:"Name"}),error:F.name?t({id:F.name,defaultMessage:"Invalid value"}):null})),e.createElement(x.P,{col:6},e.createElement(re.g,{name:"description",value:b.description||"",onChange:L,label:t({id:"global.description",defaultMessage:"Description"}),error:F.description?t({id:F.description,defaultMessage:"Invalid value"}):null}))))),!c&&e.createElement(Ee,{ref:l,permissions:g.permissions,routes:m}))))))},yt=()=>e.createElement(d.CheckPagePermissions,{permissions:P.Z.updateRole},e.createElement(ft,null)),vt=$.Ry().shape({name:$.Z_().required(d.translatedErrors.required),description:$.Z_().required(d.translatedErrors.required)}),Rt=a(98399),Ct=()=>{const{formatMessage:t}=(0,Z.useIntl)(),[n,s]=(0,e.useState)(!1),r=(0,d.useNotification)(),{goBack:u}=(0,h.useHistory)(),{lockApp:o,unlockApp:i}=(0,d.useOverlayBlocker)(),{isLoading:c,permissions:m,routes:g}=fe(),{trackUsage:p}=(0,d.useTracking)(),E=(0,e.useRef)(),l=async C=>{o(),s(!0);try{const R=E.current.getPermissions();await z.Z.post(`/${f.Z}/roles`,{...C,...R,users:[]}),p("didCreateRole"),r({type:"success",message:{id:(0,G.Z)("Settings.roles.created"),defaultMessage:"Role created"}}),u()}catch(R){Rt.error(R),r({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}s(!1),i()};return e.createElement(k.o,null,e.createElement(d.SettingsPageTitle,{name:"Roles"}),e.createElement(ne.Formik,{enableReinitialize:!0,initialValues:{name:"",description:""},onSubmit:l,validationSchema:vt},({handleSubmit:C,values:R,handleChange:b,errors:L})=>e.createElement(d.Form,{noValidate:!0,onSubmit:C},e.createElement(j.T,{primaryAction:!c&&e.createElement(T.z,{type:"submit",loading:n,startIcon:e.createElement(oe.Z,null)},t({id:"global.save",defaultMessage:"Save"})),title:t({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:t({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"})}),e.createElement(U.D,null,e.createElement(D.K,{spacing:7},e.createElement(S.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(D.K,{spacing:4},e.createElement(y.Z,{variant:"delta",as:"h2"},t({id:(0,G.Z)("EditPage.form.roles"),defaultMessage:"Role details"})),e.createElement(H.r,{gap:4},e.createElement(x.P,{col:6},e.createElement(ae.o,{name:"name",value:R.name||"",onChange:b,label:t({id:"global.name",defaultMessage:"Name"}),error:L.name?t({id:L.name,defaultMessage:"Invalid value"}):null})),e.createElement(x.P,{col:6},e.createElement(re.g,{name:"description",value:R.description||"",onChange:b,label:t({id:"global.description",defaultMessage:"Description"}),error:L.description?t({id:L.description,defaultMessage:"Invalid value"}):null}))))),!c&&e.createElement(Ee,{ref:E,permissions:m,routes:g}))))))},Pt=()=>e.createElement(d.CheckPagePermissions,{permissions:P.Z.createRole},e.createElement(Ct,null)),Tt=()=>e.createElement(d.CheckPagePermissions,{permissions:P.Z.accessRoles},e.createElement(h.Switch,null,e.createElement(h.Route,{path:`/settings/${f.Z}/roles/new`,component:Pt,exact:!0}),e.createElement(h.Route,{path:`/settings/${f.Z}/roles/:id`,component:yt,exact:!0}),e.createElement(h.Route,{path:`/settings/${f.Z}/roles`,component:Ue,exact:!0}),e.createElement(h.Route,{path:"",component:d.NotFound})))},8917:function(te,I,a){var e=a(55721),h=a(88425),d=a.n(h);const f=e.Z.create({baseURL:"http://localhost:1337"});f.interceptors.request.use(async T=>(T.headers={Authorization:`Bearer ${h.auth.getToken()}`,Accept:"application/json","Content-Type":"application/json"},T),T=>{Promise.reject(T)}),f.interceptors.response.use(T=>T,T=>{throw T.response?.status===401&&(h.auth.clearAppStorage(),window.location.reload()),T});const P=(0,h.wrapAxiosInstance)(f);I.Z=P},59677:function(te,I,a){a.d(I,{be:function(){return e.Z},YX:function(){return f},Gc:function(){return X},OB:function(){return j.Z}});var e=a(8917),h=a(92891),f=N=>Object.keys(N).reduce((U,k)=>{const K=N[k].controllers,w=Object.keys(K).reduce((B,A)=>((0,h.isEmpty)(K[A])||(B[A]=K[A]),B),{});return(0,h.isEmpty)(w)||(U[k]={controllers:w}),U},{}),P=a(90201),X=N=>`/${P.Z}/${N}`,j=a(82069)}}]);
