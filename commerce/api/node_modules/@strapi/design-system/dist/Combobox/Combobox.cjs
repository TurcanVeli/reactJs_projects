"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const a=require("react"),xe=require("prop-types"),H=require("@strapi/icons"),ye=require("../helpers/useId.cjs"),l=require("./utils.cjs"),_=require("../Flex/Flex.cjs"),N=require("../Select/components.cjs"),he=require("../Popover/Popover.cjs"),ve=require("../Box/Box.cjs"),U=require("../Typography/Typography.cjs"),Ee=require("../Loader/Loader.cjs"),k=require("./components.cjs"),Fe=require("./ComboboxOption.cjs"),Ie=require("./ComboboxList.cjs"),ke=require("../Field/Field.cjs"),qe=require("../Field/FieldLabel.cjs");require("../Field/FieldInput.cjs");const je=require("../Field/FieldHint.cjs"),Me=require("../Field/FieldError.cjs");require("../Field/FieldContext.cjs");require("../Field/FieldAction.cjs");const Oe=require("../Stack/Stack.cjs"),Le=require("../helpers/keyboardKeys.cjs"),Se=require("../VisuallyHidden/VisuallyHidden.cjs"),z=r=>r&&typeof r=="object"&&"default"in r?r:{default:r},o=z(a),e=z(xe),h=({children:r,clearLabel:W,creatable:v,createMessage:G,disabled:d,error:q,hasMoreItems:J,hint:L,label:C,labelAction:Q,loading:j,loadingMessage:X,noOptionsMessage:Y,onChange:S,onClear:R,onCreateOption:Z,onInputChange:A,onLoadMore:ee,placeholder:te,required:T,value:p,...oe})=>{const ne=()=>r.find(t=>t.props?.value.toLowerCase()===p.toLowerCase()).props?.children,[i,w]=a.useState(0),[ae,re]=a.useState(null),[u,$]=a.useState(r),[m,le]=a.useState(!1),[s,F]=a.useState(""),x=a.useRef(),I=a.useRef(!1),E=a.useRef(),B=a.useRef(),se=a.useRef(),P=a.useRef(!0),c=ye.useId("combobox"),D=`${c}-label`;if(!C&&!oe["aria-label"])throw new Error('The Combobox component needs a "label" or an "aria-label" props');a.useEffect(()=>{$(l.filterOptions(r,s))},[s,r]),a.useEffect(()=>{m&&x.current&&l.maintainScrollVisibility(x.current)},[i,m]),a.useLayoutEffect(()=>{P.current&&(P.current=!1)},[p]);const ie=m?`${c}-${i}`:"",V=()=>{S(null),F("")},ce=t=>{A&&A(t);const n=E.current.value;$(l.filterOptions(r,n)),w(0),re(null),s!==n&&F(n),m||b(!0,!1)},ue=t=>{const{key:n}=t,f=v&&s?u.length:u.length-1,y=l.getActionFromKey(n,m);switch(p&&!s&&n===Le.KeyboardKeys.BACKSPACE&&V(),y){case l.MenuActions.Next:{if(i===f){g(0);break}g(l.getUpdatedIndex(i,f,y));break}case l.MenuActions.Previous:{if(i===0){g(f);break}g(l.getUpdatedIndex(i,f,y));break}case l.MenuActions.Last:case l.MenuActions.First:{if(i===f){g(0);break}g(l.getUpdatedIndex(i,f,y));break}case l.MenuActions.CloseSelect:t.preventDefault(),M(i);break;case l.MenuActions.Close:t.preventDefault(),b(!1);break;case l.MenuActions.Open:b(!0);break}},de=t=>{if(t.preventDefault(),p&&!I.current&&F(""),I.current){I.current=!1;return}b(!1,!1)},g=t=>{w(t)},fe=t=>{g(t),M(t)},K=()=>{I.current=!0},M=t=>{const n=u[t];if(F(""),n){S(n.props.value),b(!1);return}v&&(Z(s),b(!1))},b=(t,n=!0)=>{le(t),n&&E.current.focus()},pe=a.Children.toArray(u).map((t,n)=>{const f=i===n;return a.cloneElement(t,{id:`${c}-${n}`,"aria-selected":ae===n,"aria-posinset":n+1,"aria-setsize":a.Children.toArray(u).length,ref(y){f&&(x.current=y)},onClick:()=>fe(n),onMouseDown:K,isSelected:f})}),be=()=>{E.current.focus(),R&&R(),V()},me=()=>{E.current.focus(),b(!0)},ge=()=>{const t=u.findIndex(n=>n.props?.children===s);return s&&t===-1},Ce=t=>{t.preventDefault(),b(t,!0)};return o.default.createElement(ke.Field,{hint:L,error:q,id:c,required:T},o.default.createElement(Se.VisuallyHidden,{"aria-live":"polite","aria-atomic":"false","aria-relevant":"additions text"},p),o.default.createElement(Oe.Stack,{spacing:C||L||q?1:0},C&&o.default.createElement(qe.FieldLabel,{action:Q},C),o.default.createElement(k.MainRow,{ref:B,$disabled:d,hasError:q},o.default.createElement(k.InputContainer,{wrap:"wrap"},!s&&p&&o.default.createElement(k.ValueContainer,{id:`${c}-selected-value`},o.default.createElement(U.Typography,null,ne())),o.default.createElement(k.Input,{"aria-activedescendant":ie,"aria-autocomplete":"list","aria-controls":`${c}-listbox`,"aria-disabled":d,"aria-expanded":m,"aria-haspopup":"listbox","aria-labelledby":C?D:void 0,autoComplete:"off",autoCorrect:"off",id:c,onBlur:d?void 0:de,onClick:d?void 0:Ce,onInput:d?void 0:ce,onKeyDown:d?void 0:ue,placeholder:p?"":te,readOnly:d,ref:E,required:T,role:"combobox",spellCheck:"off",type:"text",value:s})),o.default.createElement(_.Flex,null,(p||s)&&o.default.createElement(N.IconBox,{id:`${c}-clear`,"aria-label":W,disabled:d,paddingLeft:3,as:"button",onClick:be,type:"button"},o.default.createElement(H.Cross,null)),o.default.createElement(N.CaretBox,{disabled:d,paddingLeft:3,"aria-hidden":!0,as:"button",onClick:me,tabIndex:-1,type:"button"},o.default.createElement(H.CarretDown,null)))),o.default.createElement(je.FieldHint,null),o.default.createElement(Me.FieldError,null)),m&&o.default.createElement(he.Popover,{id:`${c}-popover`,source:B,spacing:4,fullWidth:!0,intersectionId:`${c}-listbox-popover-intersection`,onReachEnd:J&&!j?ee:void 0},o.default.createElement("div",{role:"listbox",ref:se,id:`${c}-listbox`,"aria-labelledby":C?D:void 0},(Boolean(u.length)||v)&&o.default.createElement(o.default.Fragment,null,o.default.createElement(Ie.ComboboxList,{activeOptionRef:x,options:pe}),ge()&&v&&o.default.createElement(Fe.ComboboxOption,{isSelected:i===u.length,ref:t=>{i===u.length&&(x.current=t)},onMouseDown:K,onClick:()=>M(),taindex:0},G(s))),!u.length&&!v&&!j&&o.default.createElement(ve.Box,{paddingLeft:4,paddingRight:4,paddingTop:2,paddingBottom:2,ref:x},o.default.createElement(U.Typography,{textColor:"neutral800"},Y(s))),j&&o.default.createElement(_.Flex,{justifyContent:"center",alignItems:"center",paddingTop:2,paddingBottom:2},o.default.createElement(Ee.Loader,{small:!0},X)))))},O=r=>o.default.createElement(h,{...r,creatable:!0});h.defaultProps={"aria-label":void 0,clearLabel:"clear",creatable:!1,createMessage:r=>`Create "${r}"`,disabled:!1,error:void 0,hasMoreItems:!1,hint:void 0,label:void 0,loading:!1,loadingMessage:"Loading content...",noOptionsMessage:()=>"No results found",onClear:void 0,onCreateOption:void 0,onInputChange:void 0,onLoadMore:void 0,placeholder:"Select or enter a value",value:void 0};O.defaultProps=h.defaultProps;h.propTypes={"aria-label":e.default.string,children:e.default.oneOfType([e.default.arrayOf(e.default.node),e.default.node]),clearLabel:e.default.string,creatable:e.default.bool,createMessage:e.default.func,disabled:e.default.bool,error:e.default.string,hasMoreItems:e.default.bool,hint:e.default.oneOfType([e.default.string,e.default.node,e.default.arrayOf(e.default.node)]),label:e.default.string,labelAction:e.default.element,loading:e.default.bool,loadingMessage:e.default.string,noOptionsMessage:e.default.func,onChange:e.default.func.isRequired,onClear:e.default.func,onCreateOption:e.default.func,onInputChange:e.default.func,onLoadMore:e.default.func,placeholder:e.default.string,value:e.default.string};O.propTypes={...h.propTypes,onCreateOption:e.default.func.isRequired};exports.Combobox=h;exports.CreatableCombobox=O;
