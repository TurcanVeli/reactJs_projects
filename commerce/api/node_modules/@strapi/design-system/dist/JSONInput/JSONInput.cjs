"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const l=require("react"),L=require("prop-types"),S=require("@codemirror/lang-json"),_=require("@uiw/react-codemirror"),x=require("../Field/Field.cjs"),A=require("../Field/FieldLabel.cjs");require("../Field/FieldInput.cjs");const H=require("../Field/FieldHint.cjs"),R=require("../Field/FieldError.cjs");require("../Field/FieldContext.cjs");require("../Field/FieldAction.cjs");const T=require("../Stack/Stack.cjs"),P=require("./JSONInputContainer.cjs"),s=require("./utils/decorationExtension.cjs"),b=n=>n&&typeof n=="object"&&"default"in n?n:{default:n},o=b(l),t=b(L),f=({label:n,value:m,error:g,hint:q,required:j,onChange:C,disabled:O,labelAction:k,...y})=>{const u=l.useRef(),a=l.useRef(null),c=l.useRef(null),h=Boolean(g),J=e=>a.current?.doc?.line(e),N=e=>{const{text:r,to:i}=J(e),d=i-r.trimStart().length;i>d&&c.current?.dispatch({effects:s.addMarks.of([s.lineHighlightMark.range(d,i)])})},v=()=>{const e=a.current?.doc?.length||0;c.current?.dispatch({effects:s.filterMarks.of((r,i)=>i<=0||r>=e)})},p=e=>{const{view:r,state:i}=e;c.current=r,a.current=i,v();const E=S.jsonParseLinter()(r);E.length&&N(i.doc.lineAt(E[0].from).number)},I=(e,r)=>{p(r),C(e)},M=(e,r)=>{c.current=e,a.current=r,p({view:e,state:r})},{setContainer:F}=_.useCodeMirror({value:m,onCreateEditor:M,theme:"dark",onChange:I,editable:!O,container:u.current,extensions:[S.json(),s.markField],basicSetup:{lineNumbers:!0,bracketMatching:!0,closeBrackets:!0,indentOnInput:!0,syntaxHighlighting:!0,highlightSelectionMatches:!0,tabSize:2,defaultCharacterWidth:5}});return l.useEffect(()=>{const e=u.current;e&&F(e)},[F,h]),o.default.createElement(x.Field,{error:g,hint:q,required:j},o.default.createElement(T.Stack,{spacing:1},n&&o.default.createElement(A.FieldLabel,{action:k},n),o.default.createElement(P.JSONInputContainer,{ref:u,hasError:h,alignItems:"stretch",fontSize:2,hasRadius:!0,...y}),o.default.createElement(R.FieldError,null),o.default.createElement(H.FieldHint,null)))};f.defaultProps={label:void 0,labelAction:void 0,value:"",error:void 0,hint:void 0,required:!1,disabled:!1,onChange(){}};f.propTypes={label:t.default.string,labelAction:t.default.element,value:t.default.string,error:t.default.oneOfType([t.default.string,t.default.bool]),hint:t.default.oneOfType([t.default.string,t.default.node,t.default.arrayOf(t.default.node)]),required:t.default.bool,disabled:t.default.bool,onChange:t.default.func};exports.JSONInput=f;
